--- linux-5.4.99/drivers/block/nbd.c	2021-02-17 17:35:20.000000000 +0800
+++ linux/drivers/block/nbd.c	2021-03-11 15:13:12.644219235 +0800
@@ -2283,6 +2283,12 @@
 	}
 
 	dev_list = nla_nest_start_noflag(reply, NBD_ATTR_DEVICE_LIST);
+	if(!dev_list)
+	{
+		nlmsg_free(reply);
+		goto out;
+	}
+
 	if (index == -1) {
 		ret = idr_for_each(&nbd_index_idr, &status_cb, reply);
 		if (ret) {
